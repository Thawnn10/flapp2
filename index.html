<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird của Thawn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        canvas {
            touch-action: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center max-w-5xl">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-amber-400 rounded-full flex items-center justify-center font-bold text-white">F</div>
                <h1 class="text-xl font-bold text-slate-700 tracking-tight">TaQuangThanhA1K64</h1>
            </div>
            <nav class="hidden sm:flex gap-4 text-sm font-medium text-slate-500">
                <a href="#game-section" class="hover:text-blue-600 transition-colors">Trò chơi</a>
                <a href="#analytics-section" class="hover:text-blue-600 transition-colors">Phân tích</a>
                <a href="#insights-section" class="hover:text-blue-600 transition-colors">Cơ chế</a>
            </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-5xl space-y-12">

        <!-- Introduction -->
        <section class="text-center max-w-2xl mx-auto">
            <h2 class="text-3xl font-bold text-slate-800 mb-3">Flappy bird</h2>
            <p class="text-slate-600 leading-relaxed">
                - i luv u so much -

            </p>
        </section>

        <!-- Game Interface Section -->
        <section id="game-section" class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
            <div class="p-6 border-b border-slate-100 bg-slate-50 flex justify-between items-center flex-wrap gap-4">
                <div>
                    <h3 class="text-lg font-bold text-slate-700">Giao Diện Mô Phỏng</h3>
                    <p class="text-sm text-slate-500">Nhấn phím Space hoặc chạm vào màn hình để bay.</p>
                </div>
                <div class="flex gap-4">
                    <div class="text-right">
                        <span class="block text-xs text-slate-400 uppercase font-bold tracking-wider">Điểm Hiện Tại</span>
                        <span id="current-score" class="text-2xl font-bold text-blue-600">0</span>
                    </div>
                    <div class="text-right">
                        <span class="block text-xs text-slate-400 uppercase font-bold tracking-wider">Kỷ Lục</span>
                        <span id="best-score" class="text-2xl font-bold text-amber-500">0</span>
                    </div>
                </div>
            </div>
            
            <div class="relative w-full bg-slate-800 flex justify-center items-center py-4 sm:py-8">
                <div class="relative shadow-2xl rounded-lg overflow-hidden ring-4 ring-slate-700/50" style="width: 320px; height: 480px;">
                    <canvas id="gameCanvas" width="320" height="480" class="block bg-sky-300 cursor-pointer"></canvas>
                    
                    <div id="gameOverlay" class="absolute inset-0 bg-black/40 flex flex-col items-center justify-center text-white backdrop-blur-sm transition-opacity duration-300">
                        <div class="bg-white/10 p-6 rounded-2xl border border-white/20 text-center shadow-xl backdrop-blur-md">
                            <h2 id="overlayTitle" class="text-3xl font-bold mb-2 drop-shadow-md">Sẵn Sàng?</h2>
                            <p id="overlaySubtitle" class="text-sm opacity-90 mb-6">Nhấn hoặc Click để bắt đầu thu thập dữ liệu</p>
                            <button id="actionBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition-all transform hover:scale-105 active:scale-95">
                                Bắt Đầu
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Dashboard Section -->
        <section id="analytics-section" class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Introductory Text for Analytics -->
            <div class="col-span-1 md:col-span-2">
                <h3 class="text-xl font-bold text-slate-800 border-l-4 border-blue-500 pl-3 mb-2">Bảng Phân Tích Hiệu Suất</h3>
                <p class="text-slate-600 text-sm">
                    Phần này hiển thị dữ liệu định lượng được tổng hợp từ các lượt chơi của bạn. Biểu đồ sẽ tự động cập nhật sau mỗi lần "Game Over", giúp bạn hình dung xu hướng tiến bộ hoặc sự mệt mỏi qua thời gian.
                </p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100">
                    <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Tổng Lượt Chơi</div>
                    <div id="total-games" class="text-3xl font-bold text-slate-700">0</div>
                    <div class="text-xs text-slate-500 mt-2">Phiên hiện tại</div>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100">
                    <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Điểm Trung Bình</div>
                    <div id="avg-score" class="text-3xl font-bold text-blue-600">0.0</div>
                    <div class="text-xs text-slate-500 mt-2">Hiệu suất tổng thể</div>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100">
                    <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Tỷ Lệ "Vượt 10"</div>
                    <div id="pass-rate" class="text-3xl font-bold text-green-600">0%</div>
                    <div class="text-xs text-slate-500 mt-2">Lượt chơi > 10 điểm</div>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100">
                    <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Xu Hướng</div>
                    <div id="trend-indicator" class="text-3xl font-bold text-slate-700">-</div>
                    <div class="text-xs text-slate-500 mt-2">So với 5 lượt trước</div>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex flex-col justify-between">
                <div class="mb-4">
                    <h4 class="font-bold text-slate-700">Lịch Sử Điểm Số</h4>
                    <p class="text-xs text-slate-500">Biểu diễn trực quan sự biến động phong độ.</p>
                </div>
                <!-- Required Chart Container Wrapper -->
                <div class="chart-container mx-auto">
                    <canvas id="scoreChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Insights & Mechanics (Qualitative Content) -->
        <section id="insights-section" class="bg-slate-100 rounded-2xl p-8 border border-slate-200">
            <h3 class="text-xl font-bold text-slate-800 border-l-4 border-amber-500 pl-3 mb-4">Cơ Chế & Phân Tích Định Tính</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-2">
                    <h4 class="font-semibold text-slate-700 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                        Trọng Lực (Gravity)
                    </h4>
                    <p class="text-sm text-slate-600 leading-relaxed">
                       
                    </p>
                </div>
                <div class="space-y-2">
                    <h4 class="font-semibold text-slate-700 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span>
                        Vận Tốc (Velocity)
                    </h4>
                    <p class="text-sm text-slate-600 leading-relaxed">
                    </p>
                </div>
                <div class="space-y-2">
                    <h4 class="font-semibold text-slate-700 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                        Phát Hiện Va Chạm
                    </h4>
                    <p class="text-sm text-slate-600 leading-relaxed">
                    </p>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-slate-200 py-8 mt-auto">
        <div class="container mx-auto px-4 text-center text-slate-400 text-sm">
            <p>&copy; 2025 - TaQuangThanh -</p>
            <p class="mt-2 text-xs">TaQanThawn</p>
        </div>
    </footer>

    <!-- LOGIC SCRIPT -->
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let score = 0;
        let bestScore = 0;
        let isPlaying = false;
        let isGameOver = false;
        let animationId;
        
        // Time tracking variables for frame rate independence
        let lastTime = 0;
        const FPS_INTERVAL = 1000 / 60; // Target time interval for 60 FPS (16.67ms)

        // Physics Constants (tuned for consistent speed regardless of FPS)
        // These are now per-frame values IF running at 60 FPS, and will be scaled by deltaTime
        const BASE_GRAVITY = 0.25;
        const BASE_JUMP = 4.5;
        const BASE_SPEED = 2;
        const PIPE_SPAWN_INTERVAL = 2000; // Spawn pipe every 2000ms (2 seconds)
        let pipeSpawnTimer = 0;

        const sessionData = {
            scores: [],
            timestamps: [],
            totalGames: 0
        };

        const currentScoreEl = document.getElementById('current-score');
        const bestScoreEl = document.getElementById('best-score');
        const overlay = document.getElementById('gameOverlay');
        const actionBtn = document.getElementById('actionBtn');
        const overlayTitle = document.getElementById('overlayTitle');
        const overlaySubtitle = document.getElementById('overlaySubtitle');

        const totalGamesEl = document.getElementById('total-games');
        const avgScoreEl = document.getElementById('avg-score');
        const passRateEl = document.getElementById('pass-rate');
        const trendEl = document.getElementById('trend-indicator');

        const bird = {
            x: 50,
            y: 150,
            w: 25,
            h: 25,
            radius: 12,
            velocity: 0,
            
            draw: function() {
                ctx.fillStyle = "#fbbf24";
                ctx.beginPath();
                ctx.arc(this.x + this.w/2, this.y + this.h/2, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = "#fff";
                ctx.beginPath();
                ctx.arc(this.x + this.w/2 + 6, this.y + this.h/2 - 6, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = "#000";
                ctx.beginPath();
                ctx.arc(this.x + this.w/2 + 7, this.y + this.h/2 - 6, 1.5, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = "#fff";
                ctx.beginPath();
                ctx.ellipse(this.x + this.w/2 - 2, this.y + this.h/2 + 3, 6, 4, 0.2, 0, Math.PI * 2);
                ctx.fill();
            },
            
            update: function(scaleFactor) {
                this.velocity += BASE_GRAVITY * scaleFactor;
                this.y += this.velocity * scaleFactor;
                
                if (this.y + this.h >= canvas.height - fg.h) {
                    this.y = canvas.height - fg.h - this.h;
                    gameOver();
                }
                
                if (this.y < 0) {
                    this.velocity = 0;
                    this.y = 0;
                }
            },
            
            jump: function() {
                this.velocity = -BASE_JUMP;
            },

            reset: function() {
                this.y = 150;
                this.velocity = 0;
            }
        };

        const fg = {
            h: 80,
            x: 0,
            draw: function() {
                ctx.fillStyle = "#dedede";
                ctx.fillRect(0, canvas.height - this.h, canvas.width, 10);
                
                ctx.fillStyle = "#f8fafc";
                ctx.fillRect(0, canvas.height - this.h + 10, canvas.width, this.h - 10);

                ctx.fillStyle = "#e2e8f0";
                for(let i = this.x; i < canvas.width; i += 30) {
                    ctx.fillRect(i % canvas.width, canvas.height - this.h + 10, 15, this.h - 10);
                }
            },
            update: function(scaleFactor) {
                // Update pattern movement scaled by time
                this.x = (this.x + BASE_SPEED * scaleFactor) % 30;
            }
        };

        const bg = {
            draw: function() {
                ctx.fillStyle = "#7dd3fc";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = "rgba(255, 255, 255, 0.6)";
                ctx.beginPath();
                ctx.arc(100, 350, 30, 0, Math.PI * 2);
                ctx.arc(140, 360, 40, 0, Math.PI * 2);
                ctx.arc(180, 350, 30, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(280, 100, 20, 0, Math.PI * 2);
                ctx.arc(310, 110, 25, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        const pipes = {
            position: [],
            w: 52,
            gap: 120,
            dx: BASE_SPEED,
            
            draw: function() {
                for(let i = 0; i < this.position.length; i++) {
                    let p = this.position[i];
                    let topY = p.y;
                    let bottomY = p.y + this.gap;
                    
                    ctx.fillStyle = "#22c55e";
                    
                    ctx.fillRect(p.x, 0, this.w, topY);
                    ctx.fillStyle = "#16a34a";
                    ctx.fillRect(p.x - 2, topY - 20, this.w + 4, 20);
                    
                    ctx.fillStyle = "#22c55e";
                    ctx.fillRect(p.x, topY + this.gap, this.w, canvas.height - topY - this.gap - fg.h);
                    ctx.fillStyle = "#16a34a";
                    ctx.fillRect(p.x - 2, topY + this.gap, this.w + 4, 20);
                }
            },
            
            update: function(scaleFactor) {
                // Pipe Spawning based on time accumulator
                pipeSpawnTimer += scaleFactor * FPS_INTERVAL;
                if(pipeSpawnTimer > PIPE_SPAWN_INTERVAL) {
                    this.position.push({
                        x: canvas.width,
                        y: Math.random() * (canvas.height - fg.h - 200) + 50,
                        passed: false
                    });
                    pipeSpawnTimer -= PIPE_SPAWN_INTERVAL;
                }
                
                for(let i = 0; i < this.position.length; i++) {
                    let p = this.position[i];
                    // Pipe movement scaled by time
                    p.x -= this.dx * scaleFactor;
                    
                    let bottomPipeY = p.y + this.gap;
                    
                    if(bird.x + bird.w > p.x && bird.x < p.x + this.w) {
                        if(bird.y < p.y || bird.y + bird.h > bottomPipeY) {
                            gameOver();
                        }
                    }
                    
                    if(p.x + this.w < bird.x && !p.passed) {
                        score++;
                        currentScoreEl.innerText = score;
                        bestScore = Math.max(score, bestScore);
                        bestScoreEl.innerText = bestScore;
                        p.passed = true;
                    }
                    
                    if(p.x + this.w < 0) {
                        this.position.shift();
                        i--;
                    }
                }
            },

            reset: function() {
                this.position = [];
                pipeSpawnTimer = 0;
            }
        };

        let scoreChartInstance = null;

        function initChart() {
            const ctxChart = document.getElementById('scoreChart').getContext('2d');
            scoreChartInstance = new Chart(ctxChart, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Điểm số',
                        data: [],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3,
                        fill: true,
                        pointRadius: 4,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: 'rgb(59, 130, 246)'
                    }, {
                        label: 'Trung bình',
                        data: [],
                        borderColor: 'rgb(245, 158, 11)',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateAnalytics() {
            sessionData.scores.push(score);
            sessionData.totalGames++;
            const labels = sessionData.scores.map((_, i) => `Lượt ${i + 1}`);
            
            const totalScore = sessionData.scores.reduce((a, b) => a + b, 0);
            const avg = (totalScore / sessionData.totalGames).toFixed(1);
            const highScores = sessionData.scores.filter(s => s > 10).length;
            const rate = ((highScores / sessionData.totalGames) * 100).toFixed(0);

            let trend = "Ổn định";
            if(sessionData.scores.length >= 2) {
                const last = sessionData.scores[sessionData.scores.length-1];
                const prev = sessionData.scores[sessionData.scores.length-2];
                if (last > prev) trend = "▲ Tăng";
                else if (last < prev) trend = "▼ Giảm";
            }

            totalGamesEl.innerText = sessionData.totalGames;
            avgScoreEl.innerText = avg;
            passRateEl.innerText = `${rate}%`;
            trendEl.innerText = trend;
            trendEl.className = `text-3xl font-bold ${trend.includes('Tăng') ? 'text-green-600' : (trend.includes('Giảm') ? 'text-red-500' : 'text-slate-700')}`;

            scoreChartInstance.data.labels = labels;
            scoreChartInstance.data.datasets[0].data = sessionData.scores;
            const avgData = Array(sessionData.totalGames).fill(avg);
            scoreChartInstance.data.datasets[1].data = avgData;
            
            scoreChartInstance.update();
        }

        function loop(currentTime) {
            if (!isPlaying) return;
            
            if (lastTime === 0) lastTime = currentTime;
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;

            // Scale factor ensures movement is the same regardless of frame rate
            const scaleFactor = deltaTime / FPS_INTERVAL; 
            
            bg.draw();
            pipes.update(scaleFactor);
            pipes.draw();
            fg.update(scaleFactor);
            fg.draw();
            
            bird.update(scaleFactor);
            bird.draw();
            
            animationId = requestAnimationFrame(loop);
        }

        function startGame() {
            if (isPlaying) return;
            
            bird.reset();
            pipes.reset();
            score = 0;
            currentScoreEl.innerText = score;
            lastTime = performance.now(); // Reset time tracking
            
            isPlaying = true;
            isGameOver = false;
            overlay.classList.add('opacity-0', 'pointer-events-none');
            
            loop(lastTime);
        }

        function gameOver() {
            isPlaying = false;
            isGameOver = true;
            cancelAnimationFrame(animationId);
            
            overlayTitle.innerText = "Kết Thúc!";
            overlaySubtitle.innerText = `Điểm số: ${score} | Kỷ lục: ${bestScore}`;
            actionBtn.innerText = "Chơi Lại";
            overlay.classList.remove('opacity-0', 'pointer-events-none');
            
            updateAnalytics();
        }

        function handleInput(e) {
            if(e.type === 'keydown' && e.code !== 'Space') return;
            if(e.type === 'keydown') e.preventDefault();
            
            if (!isPlaying && !isGameOver) {
                // Wait for button press to start initially
            } else if (isGameOver) {
                // Do nothing, button press required
            } else {
                bird.jump();
            }
        }

        window.addEventListener('keydown', handleInput);
        canvas.addEventListener('mousedown', handleInput);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(e); }, {passive: false});

        actionBtn.addEventListener('click', startGame);

        bg.draw();
        fg.draw();
        bird.draw();
        initChart();
    </script>
</body>

</html>
